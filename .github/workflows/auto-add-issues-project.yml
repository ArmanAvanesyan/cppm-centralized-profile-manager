name: "Auto Add Issues to Project with Labels"

on:
  issues:
    types: [opened, edited]

jobs:
  add-to-project:
    runs-on: ubuntu-latest
    steps:
      - name: Add Issue to GitHub Project
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const projectId = "PVT_kwHOBXlNW84Azyle";
            const issueNodeId = context.payload.issue.node_id;

            if (!issueNodeId) {
              console.error("Issue Node ID is missing.");
              return;
            }

            const mutation = `
              mutation($projectId: ID!, $contentId: ID!) {
                addProjectV2ItemById(input: { projectId: $projectId, contentId: $contentId }) {
                  item { id }
                }
              }
            `;

            await github.graphql(mutation, {
              projectId: projectId,
              contentId: issueNodeId
            });

            console.log("Issue successfully added to the project.");
